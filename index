import re
import string

class UniversalEnglishToPersianTranslator:
    def __init__(self):
        self.translation_dict = {}
        self.initialize_comprehensive_dictionary()
    
    def initialize_comprehensive_dictionary(self):
        """Initialize with a much larger vocabulary"""
        base_dict = {
            # Pronouns
            'i': 'Ù…Ù†', 'you': 'ØªÙˆ', 'he': 'Ø§Ùˆ', 'she': 'Ø§Ùˆ', 'we': 'Ù…Ø§', 'they': 'Ø¢Ù†Ù‡Ø§', 'it': 'Ø¢Ù†',
            'me': 'Ù…Ù†', 'him': 'Ø§Ùˆ', 'her': 'Ø§Ùˆ', 'us': 'Ù…Ø§', 'them': 'Ø¢Ù†Ù‡Ø§',
            'my': 'Ù…Ù†', 'your': 'ØªÙˆ', 'his': 'Ø§Ùˆ', 'her': 'Ø§Ùˆ', 'our': 'Ù…Ø§', 'their': 'Ø¢Ù†Ù‡Ø§',
            'mine': 'Ù…Ø§Ù„ Ù…Ù†', 'yours': 'Ù…Ø§Ù„ ØªÙˆ', 'hers': 'Ù…Ø§Ù„ Ø§Ùˆ', 'ours': 'Ù…Ø§Ù„ Ù…Ø§', 'theirs': 'Ù…Ø§Ù„ Ø¢Ù†Ù‡Ø§',
            
            # Common verbs - FIXED: Modal verbs as separate
            'am': 'Ù‡Ø³ØªÙ…', 'is': 'Ø§Ø³Øª', 'are': 'Ù‡Ø³ØªÛŒØ¯', 'was': 'Ø¨ÙˆØ¯', 'were': 'Ø¨ÙˆØ¯ÛŒØ¯',
            'have': 'Ø¯Ø§Ø±Ù…', 'has': 'Ø¯Ø§Ø±Ø¯', 'had': 'Ø¯Ø§Ø´Øª',
            'do': 'Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'does': 'Ù…ÛŒâ€ŒÚ©Ù†Ø¯', 'did': 'Ú©Ø±Ø¯',
            'go': 'Ø¨Ø±ÙˆÛŒÙ…', 'went': 'Ø±ÙØªÛŒÙ…', 'goes': 'Ù…ÛŒâ€ŒØ±ÙˆØ¯', 'going': 'Ø±ÙØªÙ†',
            'see': 'Ù…ÛŒâ€ŒØ¨ÛŒÙ†Ù…', 'saw': 'Ø¯ÛŒØ¯Ù…', 'seen': 'Ø¯ÛŒØ¯Ù‡',
            'get': 'Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…', 'got': 'Ú¯Ø±ÙØªÙ…',
            'make': 'Ù…ÛŒâ€ŒØ³Ø§Ø²Ù…', 'made': 'Ø³Ø§Ø®ØªÙ…',
            'take': 'Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…', 'took': 'Ú¯Ø±ÙØªÙ…',
            'come': 'Ù…ÛŒâ€ŒØ¢ÛŒÙ…', 'came': 'Ø¢Ù…Ø¯Ù…',
            'know': 'Ù…ÛŒâ€ŒØ¯Ø§Ù†Ù…', 'knew': 'Ø¯Ø§Ù†Ø³ØªÙ…',
            'think': 'ÙÚ©Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'thought': 'ÙÚ©Ø± Ú©Ø±Ø¯Ù…',
            'want': 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡Ù…', 'wanted': 'Ø®ÙˆØ§Ø³ØªÙ…',
            'like': 'Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù…', 'liked': 'Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÙ…',
            'love': 'Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù…', 'loved': 'Ø¯ÙˆØ³Øª Ø¯Ø§Ø´ØªÙ…',
            'work': 'Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'worked': 'Ú©Ø§Ø± Ú©Ø±Ø¯Ù…',
            'play': 'Ø¨Ø§Ø²ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'played': 'Ø¨Ø§Ø²ÛŒ Ú©Ø±Ø¯Ù…',
            'read': 'Ù…ÛŒâ€ŒØ®ÙˆØ§Ù†Ù…', 'reading': 'Ø®ÙˆØ§Ù†Ø¯Ù†',
            'write': 'Ù…ÛŒâ€ŒÙ†ÙˆÛŒØ³Ù…', 'writing': 'Ù†ÙˆØ´ØªÙ†',
            'speak': 'ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'speaking': 'ØµØ­Ø¨Øª Ú©Ø±Ø¯Ù†',
            'understand': 'Ù…ÛŒâ€ŒÙÙ‡Ù…Ù…', 'understanding': 'ÙÙ‡Ù…ÛŒØ¯Ù†',
            'learn': 'ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…', 'learning': 'ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ',
            'teach': 'Ø¢Ù…ÙˆØ²Ø´ Ù…ÛŒâ€ŒØ¯Ù‡Ù…', 'teaching': 'Ø¢Ù…ÙˆØ²Ø´ Ø¯Ø§Ø¯Ù†',
            'say': 'Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÙ…', 'said': 'Ú¯ÙØª',
            'find': 'Ù¾ÛŒØ¯Ø§ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'found': 'Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯',
            'give': 'Ù…ÛŒâ€ŒØ¯Ù‡Ù…', 'gave': 'Ø¯Ø§Ø¯',
            'tell': 'Ù…ÛŒâ€ŒÚ¯ÙˆÛŒÙ…', 'told': 'Ú¯ÙØª',
            'call': 'ØªÙ…Ø§Ø³ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…', 'called': 'ØªÙ…Ø§Ø³ Ú¯Ø±ÙØª',
            'try': 'Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'tried': 'Ø³Ø¹ÛŒ Ú©Ø±Ø¯',
            'ask': 'Ù…ÛŒâ€ŒÙ¾Ø±Ø³Ù…', 'asked': 'Ù¾Ø±Ø³ÛŒØ¯',
            'need': 'Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù…', 'needed': 'Ù†ÛŒØ§Ø² Ø¯Ø§Ø´Øª',
            'feel': 'Ø§Ø­Ø³Ø§Ø³ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'felt': 'Ø§Ø­Ø³Ø§Ø³ Ú©Ø±Ø¯',
            'become': 'Ù…ÛŒâ€ŒØ´ÙˆÙ…', 'became': 'Ø´Ø¯',
            'leave': 'ØªØ±Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'left': 'ØªØ±Ú© Ú©Ø±Ø¯',
            'put': 'Ù…ÛŒâ€ŒÚ¯Ø°Ø§Ø±Ù…', 'put': 'Ú¯Ø°Ø§Ø´Øª',
            'mean': 'Ù…Ø¹Ù†ÛŒ Ù…ÛŒâ€ŒØ¯Ù‡Ù…', 'meant': 'Ù…Ø¹Ù†ÛŒ Ø¯Ø§Ø¯',
            'keep': 'Ù†Ú¯Ù‡ Ù…ÛŒâ€ŒØ¯Ø§Ø±Ù…', 'kept': 'Ù†Ú¯Ù‡ Ø¯Ø§Ø´Øª',
            'let': 'Ø§Ø¬Ø§Ø²Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ù…', 'let': 'Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø§Ø¯',
            'begin': 'Ø´Ø±ÙˆØ¹ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'began': 'Ø´Ø±ÙˆØ¹ Ú©Ø±Ø¯',
            'seem': 'Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ø¯', 'seemed': 'Ø¨Ù‡ Ù†Ø¸Ø± Ø±Ø³ÛŒØ¯',
            'help': 'Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'helped': 'Ú©Ù…Ú© Ú©Ø±Ø¯',
            'show': 'Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡Ù…', 'showed': 'Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯',
            'hear': 'Ù…ÛŒâ€ŒØ´Ù†ÙˆÙ…', 'heard': 'Ø´Ù†ÛŒØ¯',
            'run': 'Ù…ÛŒâ€ŒØ¯ÙˆÙ…', 'ran': 'Ø¯ÙˆÛŒØ¯',
            'move': 'Ø­Ø±Ú©Øª Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'moved': 'Ø­Ø±Ú©Øª Ú©Ø±Ø¯',
            'live': 'Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'lived': 'Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯',
            'believe': 'Ø¨Ø§ÙˆØ± Ù…ÛŒâ€ŒÚ©Ù†Ù…', 'believed': 'Ø¨Ø§ÙˆØ± Ú©Ø±Ø¯',
            'bring': 'Ù…ÛŒâ€ŒØ¢ÙˆØ±Ù…', 'brought': 'Ø¢ÙˆØ±Ø¯',
            'happen': 'Ø§ØªÙØ§Ù‚ Ù…ÛŒâ€ŒØ§ÙØªØ¯', 'happened': 'Ø§ØªÙØ§Ù‚ Ø§ÙØªØ§Ø¯',
            
            # Modal verbs - FIXED: As separate category
            'can': 'Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ…', 'could': 'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø³ØªÛŒÙ…',
            'will': 'Ø®ÙˆØ§Ù‡ÛŒÙ…', 'would': 'Ù…ÛŒâ€ŒÚ©Ø±Ø¯ÛŒÙ…',
            'shall': 'Ø¨Ø§ÛŒØ¯', 'should': 'Ø¨Ø§ÛŒØ¯',
            'may': 'Ù…Ù…Ú©Ù† Ø§Ø³Øª', 'might': 'Ù…Ù…Ú©Ù† Ø¨ÙˆØ¯',
            'must': 'Ø¨Ø§ÛŒØ¯',
            
            # Common nouns
            'time': 'Ø²Ù…Ø§Ù†', 'person': 'Ø´Ø®Øµ', 'people': 'Ù…Ø±Ø¯Ù…', 'man': 'Ù…Ø±Ø¯', 'woman': 'Ø²Ù†', 
            'child': 'Ú©ÙˆØ¯Ú©', 'children': 'Ú©ÙˆØ¯Ú©Ø§Ù†', 'family': 'Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡', 'friend': 'Ø¯ÙˆØ³Øª',
            'house': 'Ø®Ø§Ù†Ù‡', 'home': 'Ø®Ø§Ù†Ù‡', 'room': 'Ø§ØªØ§Ù‚', 'door': 'Ø¯Ø±', 'window': 'Ù¾Ù†Ø¬Ø±Ù‡',
            'car': 'Ù…Ø§Ø´ÛŒÙ†', 'bus': 'Ø§ØªÙˆØ¨ÙˆØ³', 'train': 'Ù‚Ø·Ø§Ø±', 'bike': 'Ø¯ÙˆÚ†Ø±Ø®Ù‡',
            'water': 'Ø¢Ø¨', 'food': 'ØºØ°Ø§', 'bread': 'Ù†Ø§Ù†', 'rice': 'Ø¨Ø±Ù†Ø¬', 'fruit': 'Ù…ÛŒÙˆÙ‡',
            'book': 'Ú©ØªØ§Ø¨', 'pen': 'Ø®ÙˆØ¯Ú©Ø§Ø±', 'paper': 'Ú©Ø§ØºØ°', 'computer': 'Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±',
            'phone': 'ØªÙ„ÙÙ†', 'tv': 'ØªÙ„ÙˆÛŒØ²ÛŒÙˆÙ†', 'music': 'Ù…ÙˆØ³ÛŒÙ‚ÛŒ',
            'school': 'Ù…Ø¯Ø±Ø³Ù‡', 'teacher': 'Ù…Ø¹Ù„Ù…', 'student': 'Ø¯Ø§Ù†Ø´Ø¬Ùˆ', 'study': 'Ù…Ø·Ø§Ù„Ø¹Ù‡',
            'work': 'Ú©Ø§Ø±', 'job': 'Ø´ØºÙ„', 'money': 'Ù¾ÙˆÙ„', 'price': 'Ù‚ÛŒÙ…Øª',
            'city': 'Ø´Ù‡Ø±', 'country': 'Ú©Ø´ÙˆØ±', 'world': 'Ø¬Ù‡Ø§Ù†', 'street': 'Ø®ÛŒØ§Ø¨Ø§Ù†',
            'day': 'Ø±ÙˆØ²', 'night': 'Ø´Ø¨', 'week': 'Ù‡ÙØªÙ‡', 'month': 'Ù…Ø§Ù‡', 'year': 'Ø³Ø§Ù„',
            'sun': 'Ø®ÙˆØ±Ø´ÛŒØ¯', 'moon': 'Ù…Ø§Ù‡', 'star': 'Ø³ØªØ§Ø±Ù‡', 'sky': 'Ø¢Ø³Ù…Ø§Ù†',
            'tree': 'Ø¯Ø±Ø®Øª', 'flower': 'Ú¯Ù„', 'animal': 'Ø­ÛŒÙˆØ§Ù†', 'dog': 'Ø³Ú¯', 'cat': 'Ú¯Ø±Ø¨Ù‡',
            'bird': 'Ù¾Ø±Ù†Ø¯Ù‡', 'fish': 'Ù…Ø§Ù‡ÛŒ', 'horse': 'Ø§Ø³Ø¨', 'cow': 'Ú¯Ø§Ùˆ', 'chicken': 'Ù…Ø±Øº',
            'name': 'Ø§Ø³Ù…', 'word': 'Ú©Ù„Ù…Ù‡', 'number': 'Ø¹Ø¯Ø¯', 'part': 'Ù‚Ø³Ù…Øª',
            'problem': 'Ù…Ø´Ú©Ù„', 'fact': 'ÙˆØ§Ù‚Ø¹ÛŒØª', 'way': 'Ø±Ø§Ù‡', 'thing': 'Ú†ÛŒØ²',
            'life': 'Ø²Ù†Ø¯Ú¯ÛŒ', 'hand': 'Ø¯Ø³Øª', 'eye': 'Ú†Ø´Ù…', 'head': 'Ø³Ø±',
            'place': 'Ù…Ú©Ø§Ù†', 'point': 'Ù†Ù‚Ø·Ù‡', 'government': 'Ø¯ÙˆÙ„Øª', 'company': 'Ø´Ø±Ú©Øª',
            'group': 'Ú¯Ø±ÙˆÙ‡', 'case': 'Ù…ÙˆØ±Ø¯', 'table': 'Ù…ÛŒØ²', 'chair': 'ØµÙ†Ø¯Ù„ÛŒ',
            'bed': 'ØªØ®Øª', 'kitchen': 'Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡', 'bathroom': 'Ø¯Ø³ØªØ´ÙˆÛŒÛŒ',
            'garden': 'Ø¨Ø§Øº', 'park': 'Ù¾Ø§Ø±Ú©', 'shop': 'ÙØ±ÙˆØ´Ú¯Ø§Ù‡', 'market': 'Ø¨Ø§Ø²Ø§Ø±',
            'hospital': 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù†', 'doctor': 'Ø¯Ú©ØªØ±', 'medicine': 'Ø¯Ø§Ø±Ùˆ',
            'air': 'Ù‡ÙˆØ§', 'fire': 'Ø¢ØªØ´', 'earth': 'Ø²Ù…ÛŒÙ†', 'rain': 'Ø¨Ø§Ø±Ø§Ù†',
            'snow': 'Ø¨Ø±Ù', 'wind': 'Ø¨Ø§Ø¯', 'sea': 'Ø¯Ø±ÛŒØ§', 'river': 'Ø±ÙˆØ¯Ø®Ø§Ù†Ù‡',
            'mountain': 'Ú©ÙˆÙ‡', 'forest': 'Ø¬Ù†Ú¯Ù„', 'road': 'Ø¬Ø§Ø¯Ù‡', 'bridge': 'Ù¾Ù„',
            'dinner': 'Ø´Ø§Ù…', 'lunch': 'Ù†Ø§Ù‡Ø§Ø±', 'breakfast': 'ØµØ¨Ø­Ø§Ù†Ù‡',
            
            # Adjectives
            'good': 'Ø®ÙˆØ¨', 'bad': 'Ø¨Ø¯', 'big': 'Ø¨Ø²Ø±Ú¯', 'small': 'Ú©ÙˆÚ†Ú©', 
            'beautiful': 'Ø²ÛŒØ¨Ø§', 'ugly': 'Ø²Ø´Øª', 'happy': 'Ø®ÙˆØ´Ø­Ø§Ù„', 'sad': 'ØºÙ…Ú¯ÛŒÙ†',
            'angry': 'Ø¹ØµØ¨Ø§Ù†ÛŒ', 'tired': 'Ø®Ø³ØªÙ‡', 'hungry': 'Ú¯Ø±Ø³Ù†Ù‡', 'thirsty': 'ØªØ´Ù†Ù‡',
            'hot': 'Ø¯Ø§Øº', 'cold': 'Ø³Ø±Ø¯', 'warm': 'Ú¯Ø±Ù…', 'cool': 'Ø®Ù†Ú©',
            'new': 'Ø¬Ø¯ÛŒØ¯', 'old': 'Ù‚Ø¯ÛŒÙ…ÛŒ', 'young': 'Ø¬ÙˆØ§Ù†', 'fast': 'Ø³Ø±ÛŒØ¹',
            'slow': 'Ø¢Ù‡Ø³ØªÙ‡', 'easy': 'Ø¢Ø³Ø§Ù†', 'difficult': 'Ø³Ø®Øª', 'important': 'Ù…Ù‡Ù…',
            'first': 'Ø§ÙˆÙ„', 'last': 'Ø¢Ø®Ø±ÛŒÙ†', 'long': 'Ø·ÙˆÙ„Ø§Ù†ÛŒ', 'great': 'Ø¹Ø§Ù„ÛŒ',
            'little': 'Ú©ÙˆÚ†Ú©', 'own': 'Ø®ÙˆØ¯', 'other': 'Ø¯ÛŒÚ¯Ø±', 'right': 'Ø¯Ø±Ø³Øª',
            'high': 'Ø¨Ù„Ù†Ø¯', 'different': 'Ù…ØªÙØ§ÙˆØª', 'large': 'Ø¨Ø²Ø±Ú¯', 'next': 'Ø¨Ø¹Ø¯ÛŒ',
            'early': 'Ø²ÙˆØ¯', 'public': 'Ø¹Ù…ÙˆÙ…ÛŒ', 'same': 'Ù‡Ù…Ø§Ù†', 'able': 'Ù‚Ø§Ø¯Ø±',
            'strong': 'Ù‚ÙˆÛŒ', 'weak': 'Ø¶Ø¹ÛŒÙ', 'rich': 'Ø«Ø±ÙˆØªÙ…Ù†Ø¯', 'poor': 'ÙÙ‚ÛŒØ±',
            'clean': 'ØªÙ…ÛŒØ²', 'dirty': 'Ú©Ø«ÛŒÙ', 'dark': 'ØªØ§Ø±ÛŒÚ©', 'light': 'Ø±ÙˆØ´Ù†',
            'heavy': 'Ø³Ù†Ú¯ÛŒÙ†', 'soft': 'Ù†Ø±Ù…', 'hard': 'Ø³Ø®Øª', 'sweet': 'Ø´ÛŒØ±ÛŒÙ†',
            'bitter': 'ØªÙ„Ø®', 'salty': 'Ø´ÙˆØ±', 'sour': 'ØªØ±Ø´',
            
            # Adverbs
            'very': 'Ø¨Ø³ÛŒØ§Ø±', 'too': 'Ø®ÛŒÙ„ÛŒ', 'so': 'Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ†', 'also': 'Ù†ÛŒØ²',
            'only': 'ÙÙ‚Ø·', 'well': 'Ø®ÙˆØ¨', 'now': 'Ø§Ú©Ù†ÙˆÙ†', 'then': 'Ø³Ù¾Ø³',
            'here': 'Ø§ÛŒÙ†Ø¬Ø§', 'there': 'Ø¢Ù†Ø¬Ø§', 'today': 'Ø§Ù…Ø±ÙˆØ²', 'tomorrow': 'ÙØ±Ø¯Ø§',
            'yesterday': 'Ø¯ÛŒØ±ÙˆØ²', 'always': 'Ù‡Ù…ÛŒØ´Ù‡', 'never': 'Ù‡Ø±Ú¯Ø²', 'often': 'Ø§ØºÙ„Ø¨',
            'sometimes': 'Ú¯Ø§Ù‡ÛŒ Ø§ÙˆÙ‚Ø§Øª', 'usually': 'Ù…Ø¹Ù…ÙˆÙ„Ø§', 'quickly': 'Ø¨Ù‡ Ø³Ø±Ø¹Øª',
            'slowly': 'Ø¨Ù‡ Ø¢Ù‡Ø³ØªÚ¯ÛŒ', 'easily': 'Ø¨Ù‡ Ø¢Ø³Ø§Ù†ÛŒ', 'hard': 'Ø³Ø®Øª',
            'together': 'Ø¨Ø§ Ù‡Ù…', 'alone': 'ØªÙ†Ù‡Ø§', 'again': 'Ø¯ÙˆØ¨Ø§Ø±Ù‡',
            
            # Prepositions
            'in': 'Ø¯Ø±', 'on': 'Ø±ÙˆÛŒ', 'at': 'Ø¯Ø±', 'to': 'Ø¨Ù‡', 'from': 'Ø§Ø²',
            'with': 'Ø¨Ø§', 'without': 'Ø¨Ø¯ÙˆÙ†', 'for': 'Ø¨Ø±Ø§ÛŒ', 'about': 'Ø¯Ø±Ø¨Ø§Ø±Ù‡',
            'by': 'ØªÙˆØ³Ø·', 'as': 'Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù†', 'of': 'Ø§Ø²', 'up': 'Ø¨Ø§Ù„Ø§',
            'into': 'Ø¨Ù‡ Ø¯Ø§Ø®Ù„', 'through': 'Ø§Ø² Ø·Ø±ÛŒÙ‚', 'during': 'Ø¯Ø± Ø·ÙˆÙ„', 
            'before': 'Ù‚Ø¨Ù„', 'after': 'Ø¨Ø¹Ø¯', 'above': 'Ø¨Ø§Ù„Ø§', 'below': 'Ù¾Ø§ÛŒÛŒÙ†', 
            'between': 'Ø¨ÛŒÙ†', 'under': 'Ø²ÛŒØ±', 'over': 'Ø±ÙˆÛŒ', 'around': 'Ø§Ø·Ø±Ø§Ù',
            'behind': 'Ù¾Ø´Øª', 'front': 'Ø¬Ù„Ùˆ', 'inside': 'Ø¯Ø§Ø®Ù„', 'outside': 'Ø®Ø§Ø±Ø¬',
            
            # Conjunctions
            'and': 'Ùˆ', 'but': 'Ø§Ù…Ø§', 'or': 'ÛŒØ§', 'because': 'Ø²ÛŒØ±Ø§', 
            'if': 'Ø§Ú¯Ø±', 'when': 'ÙˆÙ‚ØªÛŒ', 'while': 'Ø¯Ø± Ø­Ø§Ù„ÛŒ Ú©Ù‡', 'though': 'Ø§Ú¯Ø±Ú†Ù‡',
            'where': 'Ø¬Ø§ÛŒÛŒ Ú©Ù‡', 'since': 'Ø§Ø² Ø¢Ù†Ø¬Ø§ Ú©Ù‡', 'until': 'ØªØ§',
            
            # Question words
            'what': 'Ú†Ù‡', 'who': 'Ú†Ù‡ Ú©Ø³ÛŒ', 'where': 'Ú©Ø¬Ø§', 'when': 'Ú©ÛŒ',
            'why': 'Ú†Ø±Ø§', 'how': 'Ú†Ú¯ÙˆÙ†Ù‡', 'which': 'Ú©Ø¯Ø§Ù…', 'whose': 'Ù…Ø§Ù„ Ú†Ù‡ Ú©Ø³ÛŒ',
            
            # Common phrases
            'hello': 'Ø³Ù„Ø§Ù…', 'hi': 'Ø³Ù„Ø§Ù…', 'goodbye': 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸', 'bye': 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸',
            'please': 'Ù„Ø·ÙØ§', 'thank you': 'Ù…ØªØ´Ú©Ø±Ù…', 'thanks': 'Ù…Ù…Ù†ÙˆÙ†', 
            'sorry': 'Ù…ØªØ§Ø³ÙÙ…', 'excuse me': 'Ø¨Ø¨Ø®Ø´ÛŒØ¯',
            'yes': 'Ø¨Ù„Ù‡', 'no': 'Ù†Ù‡', 'ok': 'Ø¨Ø§Ø´Ù‡', 'okay': 'Ø¨Ø§Ø´Ù‡',
        }
        
        self.translation_dict = base_dict
    
    def preprocess_text(self, text):
        """Clean and tokenize text"""
        text = text.lower()
        # Remove punctuation but keep basic sentence structure
        text = re.sub(r'[^\w\s]', ' ', text)
        # Split into words
        words = text.split()
        return words
    
    def handle_contractions(self, word):
        """Expand common English contractions"""
        contractions = {
            "i'm": "i am", "you're": "you are", "he's": "he is", "she's": "she is",
            "it's": "it is", "we're": "we are", "they're": "they are",
            "i've": "i have", "you've": "you have", "we've": "we have", "they've": "they have",
            "i'll": "i will", "you'll": "you will", "he'll": "he will", "she'll": "she will",
            "we'll": "we will", "they'll": "they will", "don't": "do not",
            "doesn't": "does not", "didn't": "did not", "can't": "cannot",
            "couldn't": "could not", "won't": "will not", "wouldn't": "would not",
            "shouldn't": "should not", "isn't": "is not", "aren't": "are not",
            "wasn't": "was not", "weren't": "were not", "haven't": "have not",
            "hasn't": "has not", "hadn't": "had not", "what's": "what is"
        }
        return contractions.get(word.lower(), word)
    
    def translate_word(self, word):
        """Translate a single word using direct dictionary lookup"""
        # Handle contractions first
        expanded = self.handle_contractions(word)
        if expanded != word:
            return expanded
        
        # Clean the word
        clean_word = word.strip(string.punctuation).lower()
        
        # Check direct translation
        if clean_word in self.translation_dict:
            return self.translation_dict[clean_word]
        
        # For unknown words, try simple plural forms
        if clean_word.endswith('s') and len(clean_word) > 1:
            singular = clean_word[:-1]
            if singular in self.translation_dict:
                return self.translation_dict[singular]
        
        # Return the original word if not found
        return clean_word
    
    def apply_persian_syntax(self, english_words, persian_words):
        """Apply proper Persian syntax rules - FIXED VERSION"""
        if not persian_words:
            return []
        
        # Remove articles and filter empty words
        filtered_persian = []
        filtered_english = []
        
        for eng, per in zip(english_words, persian_words):
            if eng not in ['the', 'a', 'an'] and per:
                filtered_persian.append(per)
                filtered_english.append(eng)
        
        if not filtered_persian:
            return []
        
        # NEW: Handle modal verbs properly
        modal_verbs = ['can', 'could', 'will', 'would', 'shall', 'should', 'may', 'might', 'must']
        main_verbs = ['go', 'come', 'see', 'know', 'want', 'like', 'love', 'work', 'play', 'read', 'write']
        
        has_modal = any(eng in modal_verbs for eng in filtered_english)
        has_main_verb = any(eng in main_verbs for eng in filtered_english)
        
        # If we have both modal and main verb, use only modal in Persian
        if has_modal and has_main_verb:
            result = []
            
            # Add subject
            for i, eng_word in enumerate(filtered_english):
                if eng_word in ['i', 'you', 'he', 'she', 'we', 'they']:
                    result.append(filtered_persian[i])
            
            # Add modal verb (skip main verb)
            for i, eng_word in enumerate(filtered_english):
                if eng_word in modal_verbs:
                    result.append(filtered_persian[i])
            
            # Add other words (objects, prepositions, etc.)
            for i, eng_word in enumerate(filtered_english):
                if (eng_word not in modal_verbs and 
                    eng_word not in main_verbs and 
                    eng_word not in ['i', 'you', 'he', 'she', 'we', 'they'] and
                    filtered_persian[i] not in result):
                    result.append(filtered_persian[i])
            
            return result
        
        # For regular sentences without modal verbs
        result = []
        
        # Add subjects first
        for i, eng_word in enumerate(filtered_english):
            if eng_word in ['i', 'you', 'he', 'she', 'we', 'they']:
                result.append(filtered_persian[i])
        
        # Add objects and other words
        for i, eng_word in enumerate(filtered_english):
            if (eng_word not in ['i', 'you', 'he', 'she', 'we', 'they'] and
                filtered_persian[i] not in result):
                result.append(filtered_persian[i])
        
        return result
    
    def translate_sentence(self, english_sentence):
        """Translate a complete sentence"""
        if not english_sentence.strip():
            return ""
        
        # Preprocess
        words = self.preprocess_text(english_sentence)
        
        # Translate each word
        translated_words = []
        for word in words:
            translation = self.translate_word(word)
            if ' ' in translation:
                translated_words.extend(translation.split())
            else:
                translated_words.append(translation)
        
        # Apply Persian syntax
        final_translation = self.apply_persian_syntax(words, translated_words)
        
        # Join and clean
        persian_sentence = ' '.join(final_translation)
        persian_sentence = re.sub(r'\s+', ' ', persian_sentence).strip()
        
        return persian_sentence

def main():
    translator = UniversalEnglishToPersianTranslator()
    
    print("=" * 70)
    print("ğŸŒ ENGLISH TO PERSIAN TRANSLATOR - FIXED MODAL VERBS")
    print("=" * 70)
    print("Now properly handles modal verbs like 'can', 'will', etc.")
    print("=" * 70)
    
    # Test with modal verbs
    test_cases = [
        "can we go for dinner",
        "i will come tomorrow",
        "you should study hard",
        "we can play football",
        "she must go to school",
        "they may come later",
        "can you help me",
        "we should eat food",
        "i can speak english",
        "you must see this"
    ]
    
    print("\nğŸ§ª MODAL VERBS TEST:")
    print("-" * 50)
    
    for i, test in enumerate(test_cases, 1):
        translation = translator.translate_sentence(test)
        print(f"{i:2d}. EN: {test}")
        print(f"    FA: {translation}")
        print()
    
    # Interactive session
    print("\nğŸ’¬ INTERACTIVE TRANSLATION:")
    print("-" * 50)
    
    while True:
        try:
            user_input = input("\nğŸ“ Enter English text (or 'quit'): ").strip()
            
            if user_input.lower() in ['quit', 'exit', 'q']:
                print("ğŸ‘‹ Goodbye! Ø®Ø¯Ø§Ø­Ø§ÙØ¸!")
                break
                
            if user_input:
                translation = translator.translate_sentence(user_input)
                print(f"\nâœ… English: {user_input}")
                print(f"âœ… Persian: {translation}")
                
                # Show word breakdown
                words = translator.preprocess_text(user_input)
                print("\nğŸ” Word breakdown:")
                for word in words:
                    trans = translator.translate_word(word)
                    if trans != word:
                        print(f"   '{word}' â†’ '{trans}'")
            else:
                print("âš ï¸  Please enter some text!")
                
        except KeyboardInterrupt:
            print("\n\nğŸ‘‹ Goodbye! Ø®Ø¯Ø§Ø­Ø§ÙØ¸!")
            break
        except Exception as e:
            print(f"âŒ Error: {e}")

if __name__ == "__main__":
    main()
